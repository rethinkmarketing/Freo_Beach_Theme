let TF_Import;((S,N,k)=>{"use strict";TF_Import={importImages(){return S.loadJs(S.url+"js/admin/import/import-images",!!N.TF_ImportImages)},init(j,A,I,v,O,T){return new Promise(async(t,e)=>{let c=!0;this.importImages(),await S.loadJs(S.url+"js/admin/notification",!!N.TF_Notification);const i=j.length,s=12<i?150:100,m=v.import_skip,g=[],l=0<v.limit?parseInt(v.limit):5,r=v.images_chunk,n=!!v.skip_builder,_=i=>{const l=[];for(let e=0,t=i.length;e<t;++e){let t="";i[e].tbp_template_name!==k?t=i[e].tbp_template_name:i[e].post_title!==k?t=i[e].post_title:i[e].title!==k?t=i[e].title.rendered!==k?i[e].title.rendered:i[e].title:i[e].name===k&&i[e].post_name===k||(t=i[e].name),t!==k&&""!==t&&l.push(t)}return 0===l.length?"":l.join(", ")},h=l=>new Promise((e,i)=>{setTimeout(()=>{let t={action:A,id:O||"",nonce:I,data:l};v.custom_params&&(t=Object.assign(t,v.custom_params)),S.fetch(t).then(t=>{(t&&t.success&&t.data?e:i)(t)}).catch(i)},s)}),o=()=>{c="visible"===N.document.visibilityState},u=(t,e)=>{const i=[];while(0<t.length)i.push(t.splice(0,e));return i},a=(e,f)=>new Promise(async t=>{let l=0,n=new Set,s=e.length,o=v.loading.replaceAll("%to%",s),a=u(e,f);for(let t=0;t<a.length;++t){let r=a[t];if(0<r.length){let e=_(r),i;if(1<s&&!0===c){l+=r.length;let t=o.replaceAll("%from%",l).replaceAll("%post%",e);120<t.length&&(t=t.slice(0,120)+"..."),await TF_Notification.show("info",t)}try{i=await h(r)}catch(t){try{i=await h(new Blob([JSON.stringify(r)],{type:"application/json"}))}catch(t){}}finally{if(i&&i.success&&i.data){let s=!1;const p=i.data;for(let i in p){let l=p[i];for(let e=r.length-1;-1<e;--e)if(r[e]!==k){let t=r[e].term_id||r[e].ID||r[e].post_id;if(i==t){if(!1===l)n.add(r[e]);else if("object"==typeof l||isNaN(l)){let t="object"==typeof l?l.msg:l;if(!0===c&&await TF_Notification.showHide("warning",m.replaceAll("%post%",_([r[e]]))+":"+t,2e3),"object"==typeof l&&l.skip){for(let e=r.length-1;-1<e;--e){let t=r[e].post_type||r[e].taxonomy;t===l.skip&&r.splice(e,1)}for(let i=a.length-1;-1<i;--i){for(let e=a[i].length-1;-1<e;--e){let t=a[i][e].post_type||a[i][e].taxonomy;t===l.skip&&(a[i].splice(e,1),s=!0)}0===a[i].length&&a.splice(i,1)}}}else!0!==l&&(r[e].term_thumb?g.push({term_id:l,url:r[e].term_thumb.trim()}):r[e].thumb&&g.push({id:l,url:r[e].thumb.trim()}));r[e]!==k&&r.splice(e,1);break}}}if(!0===s){for(let t=(a=a.flat()).length-1;-1<t;--t)0===a[t].length&&a.splice(t,1);t=-1,a=u(a,f)}}else{!0===c&&await TF_Notification.showHide("error",m.replaceAll("%post%",e),2e3);for(let t=r.length-1;-1<t;--t)n.add(r[t])}}}}t(n)}),p=t=>(t.preventDefault(),t.returnValue="Are you sure"),f=l=>{if(!Array.isArray(l)){const e=[];for(let t in l)e.push(l[t]);l=e}for(let t=l.length-1;-1<t;--t){let i=l[t].cols;if(i){if(!Array.isArray(i)){let e=[];for(let t in i)e.push(i[t]);i=l[t].cols=e}for(let t=i.length-1;-1<t;--t)i[t].modules&&(i[t].modules=f(i[t].modules))}}return l},d=i=>{for(let t=i.length-1;-1<t;--t){if(i[t].styling&&0<Object.keys(i[t].styling).length)return!0;let e=i[t].modules;if(e&&0<e.length)for(let t=e.length-1;-1<t;--t){if(!e[t].cols)return!0;if(d(e[t].cols))return!0}}return!1};N.tfOff("beforeunload",p).tfOn("beforeunload",p).document.tfOff("visibilitychange",o,{passive:!0}).tfOn("visibilitychange",o,{passive:!0});let y=new Map;v.custom_data=O||"default",v.stop_webp=1;try{let l=new Set;for(let t=j.length-1;-1<t;--t){let i=(j[t].meta_input||j[t])._themify_builder_settings_json;if(i){"string"==typeof i&&(i=JSON.parse(i)),i=f(i);let e=!1;for(let t=i.length-1;-1<t;--t)if(i[t].styling&&0<Object.keys(i[t].styling).length||i[t].cols&&d(i[t].cols)){e=!0;break}if(!1===e)j[t].meta_input?delete j[t].meta_input._themify_builder_settings_json:delete j[t]._themify_builder_settings_json;else if(!1==n){let t=(t=>{const i=new Set,s=t=>{if(t){const e=t.split("?")[0].split(".");["jpg","jpeg","tiff","png","gif","bmp","svg","webp","apng"].includes(e[e.length-1])&&i.add(t)}},l=e=>{for(let t in e)if(e[t])if(Array.isArray(e[t])||"object"==typeof e[t])l(e[t]);else{let i=e[t].toString().trim();if(i)if(i.includes("<img ")){let t=document.createElement("template"),l=(t.innerHTML=i,t.content.querySelectorAll("img"));for(let i=l.length-1;-1<i;--i){let t=l[i].src,e=l[i].srcset;e=e?e.split(" "):[],t&&e.push(t);for(let t=e.length-1;-1<t;--t)e[t]&&s(e[t].trim())}}else if("["===i[0]&&i.includes("path=")){let e=i.match(/\path.*?=.*?[\'"](.+?)[\'"]/gim);if(e&&e[0])for(let t=(e=e[0].split("path=")[1].replaceAll('"',"").replace("'","").split(",")).length-1;-1<t;--t)e[t]&&s(e[t].trim())}else s(i)}};return l(t),i})(i);0<t.size&&(l=new Set([...l,...t]))}}if(j[t]._product_image_gallery){let e=j[t]._product_image_gallery;for(let t=(e="string"==typeof e?e.split(","):e).length-1;-1<t;--t)l.add(e[t].trim())}}if(0<l.size){await this.importImages(),y=await TF_ImportImages.init([...l],I,v,r,T);for(let s=j.length-1;-1<s;--s){let i=(j[s].meta_input||j[s])._themify_builder_settings_json;if(i){"string"!=typeof i&&(i=JSON.stringify(i));for(let[t,e]of y)!1!==e&&e.src&&(i.includes(t)&&(i=i.replaceAll(t,e.src)),j[s].post_content)&&j[s].post_content.includes(t)&&(j[s].post_content=j[s].post_content.replaceAll(t,e.src));i=JSON.parse(i),j[s].meta_input&&j[s].meta_input._themify_builder_settings_json?j[s].meta_input._themify_builder_settings_json=i:j[s]._themify_builder_settings_json=i}if(j[s]._product_image_gallery){let i=j[s]._product_image_gallery,l=[];i="string"==typeof i?i.split(","):i;for(let e=0,t=i.length;e<t;++e){let t=y.get(i[e].trim());t&&l.push(t.id)}0<l.length?j[s]._product_image_gallery=l.join(","):delete j[s]._product_image_gallery}}}}catch(t){}let b=await a(j,l);if(0<b.size&&0<(b=await a([...b],2)).size&&!0===c&&await TF_Notification.showHide("error",v.import_failed.replaceAll("%post%",_(Array.from(b))),4e3),b.size===i)e(Array.from(b));else{if(0<g.length){await this.importImages();try{const w=await TF_ImportImages.init(g,I,v,r,T);y=new Map([...w,...y])}catch(t){}}t([y,b])}N.tfOff("beforeunload",p).document.tfOff("visibilitychange",o,{passive:!0})})},sort(s,r,n){const o=new Set,a=t=>{const e=parseInt(n===k?t[r]:t[r][n]),i=0<t.term_id?"term_id":"ID";for(var l=s.length-1;-1<l;--l)if(0<s[l][i]&&parseInt(s[l][i])===e){let t=s[l][r];0<(t=n!==k?t[n]:t)&&a(s[l]),o.add(s[l])}};for(var e=s.length-1;-1<e;--e){let t=s[e][r];(t=n!==k?t[n]:t)!==k&&0!=t||(o.add(s[e]),s.splice(e,1))}for(e=s.length-1;-1<e;--e){let t=s[e][r];0<(t=n!==k?t[n]:t)&&(a(s[e]),o.add(s[e]))}return[...o]}}})(Themify,window.top,void 0);