(($,W,H,D,X)=>{"use strict";W.Drag=e=>{if(!0!==W.isGSPage){let V;e.tfOn("pointerdown",e=>{1!==e.which||W.isPreview||e.target.closest(".tb_dragger,.tb_disable_sorting,.tb_editor_on")?V=null:(V=e.target).classList.contains("tb_grid_drag")?(V=null,W.columnResize(e)):0===V.tagName.indexOf("TB-")&&(V=e.composedPath()[0]).closest(".tab")&&(V=null)},{passive:!0}).tfOn("dragstart",function(S){if(V&&S.target.nodeType!==Node.TEXT_NODE){let C=S.target.closest("[draggable]");if(!C||"desktop"!==W.activeBreakPoint&&C.classList.contains("active_module"))S.preventDefault(),V=null;else{let i=C.classList,t=i.contains("module_row"),e=t,g=!t&&i.contains("module_column");t||g||(t=i.contains("page_break_module")||i.contains("predesigned_row")||i.contains("tb_item_row")),V=null,S.stopImmediatePropagation();let o,s,p=null,m=t?"row":g?"column_move":i.contains("tb_grid")?"column":"module",l=[m],_=X.body,u=0,f=0,b,n,a,r=null,h=null,d,c,v=[W.ToolBar.el.getRootNode().host,D.document.tfId("tb_fixed_bottom_scroll")],y=W.Builder.get().el,w=[D.document.body],L=X.createElement("div");const x=t=>{if(null===h&&r){h=!0;let e="tb_main_toolbar_root"===t||"wpadminbar"===t?"-":"+";e+="="+c*d+"px",r.stop().animate({scrollTop:e},{duration:10,complete(){!0===h&&(h=null,x(t))}})}},A=function(){a&&clearInterval(a),d=5,a=setInterval(()=>{d<51?d+=5:(clearInterval(a),a=null)},1200),(b=null)!==p&&(p.style.display="none");for(let e=y.querySelectorAll("[data-pos]"),t=e.length-1;-1<t;--t)e[t].removeAttribute("data-pos");x(this.id)},F=()=>{a&&clearInterval(a),h=a=null,r.stop()},P=e=>{if(a&&clearInterval(a),!0===e){for(let e=v.length-1;-1<e;--e)v[e].tfOff("dragenter",A,{passive:!0}).tfOff("dragleave",F,{passive:!0});t&&"visual"===W.mode&&W.ToolBar.zoom({item:W.ToolBar.el.querySelector('[data-zoom="100"]')}),v=h=a=d=r=c=null}else if(c=1,"visual"!==W.mode&&((r=(r=W.ToolBar.el.getRootNode().host.closest(".interface-interface-skeleton__content"))||X.tfClass("edit-post-layout__content")[0])?c/=2:r=null),r=null===r?"desktop"===W.activeBreakPoint?$("body,html"):$("body,html",D.document):$(r),t&&"visual"===W.mode&&W.ToolBar.zoom({item:W.ToolBar.el.querySelector('[data-zoom="50"]')}),0<c)for(let e=v.length-1;-1<e;--e)v[e].tfOn("dragenter",A,{passive:!0}).tfOn("dragleave",F,{passive:!0})},N=e=>{e.dataTransfer.dropEffect=e.dataTransfer.effectAllowed="none",b&&b.removeAttribute("data-pos"),null!==p&&(p.style.display="none")},T=e=>{if(e.preventDefault(),e.stopImmediatePropagation(),o&&(o.style.top=e.clientY-s+"px"),!e.target||null!==h||e.target===_||e.target===C||"module"===m&&e.target.classList.contains("module_row"))N(e);else if((null===p||e.target!==p&&!e.target.classList.contains("tb_sortable_placeholder"))&&(e.dataTransfer.effectAllowed="move",0===u||0===f||10<e.clientY-u||10<u-e.clientY||10<e.clientX-f||10<f-e.clientX||e.target!==b)){u=e.clientY,f=e.clientX;let t=e.target;const r=t.getBoundingClientRect();let s=.5<(u-r.top)/r.height?"bottom":"top";if(!0===g){let l,e=t.classList;if(e.contains("row_inner")||e.contains("row_inner"))t=(l=t).tfClass("module_column")[0],s=null;else{if(e.contains("tb_col_side"))s=e[1].replace("tb_col_side_",""),t=t.parentNode;else{if(!e.contains("module_column"))return;s=.5<(f-r.left)/r.width?"right":"left"}l=t.parentNode}let o=l.dataset.dragW,a=t.dataset.dragArea;if(!o||!a){const i=getComputedStyle(l);if(!o){const n=l.closest("[data-cid]");if(!n)return;const d=l.offsetWidth;let e=W.Registry.get(n.dataset.cid).getSizes("gutter"),t=(e=(e=e?ThemifyStyles.getGutterValue(e):"")||i.getPropertyValue("--colg")).replace(parseFloat(e).toString(),"")||"%";e=parseFloat(e),o=0===e?"none":"%"===t?parseFloat(parseFloat(d*e/100).toFixed(2)).toString():"em"===t?e*parseFloat(i.getPropertyValue("font-size")):e,l.dataset.dragW=o;for(let e=l.children,t=e.length-1;-1<t;--t)for(let l=e[t].children,a=l.length-1;-1<a;--a)if(l[a].classList.contains("tb_col_side")){l[a].style.marginLeft=l[a].style.marginRight="";let e=l[a].classList.contains("tb_col_side_right")?"50":"-50",t=(l[a].style.width="none"===o?"":o+"px",l[a].style.transform="none"===o?"translateX("+e+"%)":"",l[a].getBoundingClientRect().left);t<0?l[a].style.marginLeft="10px":t>=X.documentElement.clientWidth&&(l[a].style.marginRight="10px")}}if(!a){if(a=i.getPropertyValue("--area")){for(let t=(a=a.split('" "')).length-1;-1<t;--t){let e=a[t].replaceAll('"',"").split(" ");e=Array.from(new Set(e)),a[t]=e.join(" ")}a='"'+a.join('" "')+'"'}else a="1";l.dataset.dragArea=a}}if(null===s)return;if("1"!==a&&!t.classList.contains("tb_drag_side_column")&&!t.classList.contains("tb_drag_one_column")){const c=getComputedStyle(t).getPropertyValue("grid-area").split("/")[0].replace('"',"").trim();a.includes(c+" ")||a.includes(" "+c)?t.classList.add("tb_drag_side_column"):t.classList.add("tb_drag_one_column")}t.classList.contains("tb_drag_one_column")&&(s=.5<(u-r.top)/r.height?"right":"left")}if(t!==v[0]&&t!==v[1]){if(!o&&!1===g){if(t.classList.contains("module_column")){if(!(t=t.tfClass("tb_holder")[0]))return void N(e)}else t.classList.contains("tb_dragger")&&(t=t.parentNode);if(t.classList.contains("tb_holder")&&0<t.childElementCount&&(t="top"===s&&t.firstChild!==C?t.firstChild:t.lastChild)===C)return void N(e)}if(b&&b!==t){if(!1===g){const l="top"===s?t.previousSibling:t.nextElementSibling;if(l===b){const a=l.dataset.pos;if("top"===s&&"bottom"===a||"bottom"===s&&"top"===a)return}}b.removeAttribute("data-pos")}t.dataset.pos!==s&&(t.dataset.pos=s,null!==p)&&(p.style.display="",t.classList.contains("tb_holder")?t.appendChild(p):"top"===s?t.before(p):t.after(p)),b=t}}},B=function(e){e.stopImmediatePropagation(),w.push(W.MainPanel.el),w.push(W.ToolBar.el.getRootNode().host);for(let e=w.length-1;-1<e;--e)w[e].classList.add("tb_start_animate","tb_drag_start","tb_drag_"+l[0]),l[1]&&w[e].classList.add(l[1]);if(W.SmallPanel.hide(),W.ActionBar.clear(),this.classList.add("tb_draggable_item"),!0===g){this.parentNode.classList.add("tb_column_drag_inner");const a=y.querySelectorAll(".row_inner,.subrow_inner");for(let e=a.length-1;-1<e;--e){let t=a[e].children,l=a[e].getBoundingClientRect().width-5;for(let e=t.length-1;-1<e;--e)t[e].offsetWidth+t[e].offsetLeft<l&&t[e].classList.add("tb_hide_drag_col_right")}}P(),o&&(o.style.top=e.clientY+"px")},O=e=>{e.stopImmediatePropagation()},I=async a=>{a.target&&(a.preventDefault(),a.stopImmediatePropagation()),n=!0;let e=a.target||a;if(e.classList.contains("module_column")||e.classList.contains("tb_col_side"))e=g?e.closest(".module_column"):e.querySelector("[data-pos]");else if(g){e=null;for(let e=X.tfClass("tb_column_drag_inner"),t=e.length-1;-1<t;--t)e[t].classList.remove("tb_column_drag_inner")}else e.classList.contains("tb_dragger")&&(e=e.closest("[draggable]"));if(!(e=(e===p||e.classList.contains("tb_sortable_placeholder"))&&(e=(e=e.closest(".tb_active_builder"))&&e.querySelector("[data-pos]"))&&e.classList.contains("tb_sortable_placeholder")?e.closest(".tb_holder"):e)||"module"===m&&e.classList.contains("module_row"))C.classList.remove("tb_draggable_item");else{W.ActionBar.clear();const t=C.closest(".module_row"),l=null!==t,o=l?C:C.cloneNode(!0),s=e.dataset.pos,r=e=>{const t=e.closest(".module_row");t&&t.classList.toggle("tb_row_empty",void 0===t.tfClass("active_module")[0])};if(p&&p.remove(),o===e)C.classList.remove("tb_draggable_item");else if(W.undoManager.start("move"),C.classList.remove("tb_draggable_item"),l||(o.style.display="none"),e.classList.contains("tb_holder")?e.appendChild(o):g||("top"===s?e.before(o):e.after(o)),g||l)g&&await W.Drop.column(o,e,s),H.trigger("tb_"+m+"_sort",[o]),W.Utils._onResize(!0),r(t),r(e),W.undoManager.end("move");else{let e=i.contains("tb_grid")?"grid":i.contains("page_break_module")?"pagebreak":"predesign",t=C.dataset.slug,l="grid"===e?"row":m;C.dataset.type&&(e=C.dataset.type,"row"===l)&&i.contains("library_item")&&(e="library");try{await W.Drop[l](o,e,t),H.trigger("tb_"+m+"_sort",[o]),r(o),"module"===l&&"part"!==e&&"module"!==e?W.undoManager.clear("move"):W.undoManager.end("move")}catch(a){W.undoManager.clear("move")}}}};if(L.className="tb_sortable_helper tf_box tf_overflow",i.contains("active_subrow")&&l.push("tb_drag_subrow"),e)if(X.body.classList.add("tb_drag_row"),"visual"!==W.mode){o=L.cloneNode(),L.style.opacity=0;const M=C.getBoundingClientRect();o.style.width=M.width+"px",o.style.left=M.left+"px",o.innerHTML="Row",X.body.appendChild(o),s=o.offsetHeight/2}else L.innerHTML="Row";else if("module"===m||g)if(g||i.contains("active_subrow"))L.innerHTML=g?"Column":"Subrow";else{let e=C.dataset.slug||W.Registry.get(C.dataset.cid).get("mod_name");if(e&&themifyBuilder.modules[e]){const k=themifyBuilder.modules[e],E=k.icon,q=X.createElement("span");q.textContent=k.name,q.className="tf_vmiddle",E&&L.appendChild(W.Helper.getIcon("ti-"+E)),L.appendChild(q)}}else if("column"===m)L.className+=" "+C.className,L.innerHTML=C.innerHTML;else if("row"===m&&(i.contains("page_break_module")||i.contains("predesigned_row"))){const z=i.contains("page_break_module")?"page_break_title":"predesigned_title";L.textContent=C.tfClass(z)[0].textContent}g||!t&&"visual"===W.mode||((p=X.createElement("div")).className="tb_sortable_placeholder tf_rel tf_w");const R=L.querySelector(".add_module_btn");null!==R&&R.remove(),X.body.appendChild(L),S.dataTransfer.effectAllowed="move",S.dataTransfer.setData("Text","id"),S.dataTransfer.setDragImage(L,L.offsetWidth/2+2,L.offsetHeight/2),C.tfOn("dragend",function(e){if(e.stopImmediatePropagation(),X.body.tfOff("dragover",T),y.tfOff(["dragenter","dragleave","pointermove","pointerover","pointerout","pointerenter","pointerleave","mousemove","mouseover","mouseout","mouseenter","mouseleave"],O,{passive:!0}).tfOff("drop",I,{once:!0}),this.tfOff("drag",B,{once:!0,passive:!0}),!n){const t=y.querySelector("[data-pos]");t&&I(t)}L.remove(),o&&o.remove(),p&&p.remove();for(let e=X.querySelectorAll("[data-drag-w],[data-drag-area],[data-pos]"),t=e.length-1;-1<t;--t)e[t].removeAttribute("data-pos"),e[t].removeAttribute("data-drag-w"),e[t].removeAttribute("data-drag-area");for(let e=X.querySelectorAll(".tb_hide_drag_col_right,.tb_drag_one_column,.tb_drag_side_column,.tb_column_drag_inner"),t=e.length-1;-1<t;--t)e[t].classList.remove("tb_hide_drag_col_right","tb_drag_one_column","tb_drag_side_column","tb_column_drag_inner");if(this.classList.remove("tb_draggable_item","tb_drag_one_column","tb_drag_side_column"),P(!0),"visual"!==W.mode)for(let e=X.tfClass("is-drop-target"),t=e.length-1;-1<t;--t)e[t].classList.remove("is-drop-target");for(let e=w.length-1;-1<e;--e)w[e].classList.remove("tb_start_animate","tb_drag_start","tb_drag_start_"+l[0],"tb_drag_"+l[0]),l[1]&&w[e].classList.remove(l[1]);p=n=V=C=i=b=L=o=s=_=y=f=u=l=m=g=w=null,W.ActionBar.clear()},{once:!0,passive:!0}),"visual"===W.mode&&w.push(_);for(let e=w.length-1;-1<e;--e)w[e].classList.add("tb_drag_start_"+l[0]),l[1]&&w[e].classList.add(l[1]);C.tfOn("drag",B,{once:!0,passive:!0}),X.body.tfOn("dragover",T),y.tfOn("dragenter dragleave",O,{passive:!0}).tfOn("drop",I,{once:!0}),H.isTouch||y.tfOn(["pointermove","pointerover","pointerout","pointerenter","pointerleave","mousemove","mouseover","mouseout","mouseenter","mouseleave"],O,{passive:!0})}}else S.preventDefault(),V=null})}},W.columnResize=e=>{e.stopPropagation();const t=X.body.classList,l=e.target,o=[],s=[],r=l.parentNode,i=r.parentNode,a=getComputedStyle(i),k=i.childElementCount,E=i.offsetWidth,n=l.classList.contains("tb_drag_right")?"w":"e",d=X.createElement("div"),c=X.createElement("div"),g=getComputedStyle(r).getPropertyValue("grid-area").split("/")[0].replace('"',"").trim(),p=g&&"auto"!==g&&"initial"!==g&&"none"!==g?getComputedStyle(i).getPropertyValue("--area").replace(/  +/g," ").trim().split('" "'):"",m=a.getPropertyValue("column-gap"),_=parseFloat(m)||0;let u=getComputedStyle(i).getPropertyValue("--col").replace(/\s\s+/g," ").trim(),f,b,h=!1,v=e.clientX,y=100,w=0,L=0,C=0;if(H.trigger("disableInline"),"none"===u)u="";else if(u.includes("repeat"))if(u.includes("auto-fit")||u.includes("auto-fill"))u="";else{let o="",s=u.replace(/\s\,\s|\s\,|\,\s/g,",").replace(/\s\(\s|\s\(|\(\s/g,"(").replaceAll(" )",")").trim().split(" ");for(let a=0,e=s.length;a<e;++a)if(s[a].includes("repeat")){let e=s[a].split("(")[1].replace(")","").split(","),t=parseInt(e[0]),l=e[1].trim();isNaN(t)&&(l="1fr",t=k),o+=" "+(" "+l).repeat(t)}else o+=" "+s[a];u=o.trim()}if(p){let a=0;for(let l=p.length-1;-1<l;--l)if(p[l].includes(g)){let t=p[l].replace(/\s\s+/g," ").replaceAll('"',"").trim().split(" ");for(let e=t.length-1;-1<e;--e)t[e]===g&&(o.push(e),a=l);if(0<o.length)break}if(0<o.length){const z=Math.min.apply(null,o)-1,V=Math.max.apply(null,o)+1,N=i.children,D="w"==n?V:z,T=p[a].replace(/\s\s+/g," ").replaceAll('"',"").trim().split(" ")[D]?.trim();if(!T)return;for(let e=p.length-1;-1<e;--e)if(p[e].includes(T)){let t=p[e].replace(/\s\s+/g," ").replaceAll('"',"").trim().split(" ");for(let e=t.length-1;-1<e;--e)t[e]===T&&s.push(e);if(0<s.length)break}for(let e=N.length-1;-1<e;--e)if(r!==N[e]&&T===getComputedStyle(N[e]).getPropertyValue("grid-area").split("/")[0].replace('"',"").trim()){f=N[e];break}}const P=p[0].trim().split(" ").length;if(u){const B=P-u.split(" ").length;0<B&&(u+=" 1fr".repeat(B))}else u="1fr ".repeat(P).trim()}else{if(f="w"==n?r.previousElementSibling||r.nextElementSibling:r.nextElementSibling||r.previousElementSibling,!u){const I=[],R=i.children;for(let e=0,t=R.length;e<t;++e)I.push(R[e].getBoundingClientRect().width);const M=Math.min.apply(null,I).toFixed(2).toString();for(let e=I.length-1;-1<e;--e)I[e]=M===I[e].toFixed(2).toString()?"1fr":(I[e]/M).toFixed(2).toString().replace("0.",".")+"fr";u=I.join(" ")}const O=H.convert(i.children);o.push(O.indexOf(r)),s.push(O.indexOf(f))}(u=u.split(" "))[o[0]]||(o[0]=o[0]%u.length),u[s[0]]||(s[0]=s[0]%u.length);const S=u.length;m?m.includes("px")?C=(S-1)*_:m.includes("em")&&(L=(S-1)*_):y-=(S-1)*_;for(let t=S-1;-1<t;--t){let e=u[t];e.includes("fr")?w+=parseFloat(e):e.includes("%")?y-=parseFloat(e):e.includes("em")?L+=parseFloat(e):e.includes("px")&&(C+=parseFloat(e))}0!==L&&(L=parseFloat(a.getPropertyValue("font-size"))*L);const x=o.length,A=s.length,q=parseFloat((parseFloat(E*y/100)-C-L)/w),F=(d.className=c.className="tb_grid_drag_tooltip",l.classList.add("tb_drag_grid_current"),r.classList.add("tb_element_clicked"),"w"==n?(d.className+=" tb_grid_drag_right_tooltip",c.className+=" tb_grid_drag_left_tooltip"):(d.className+=" tb_grid_drag_left_tooltip",c.className+=" tb_grid_drag_right_tooltip"),r.style.willChange="width",f&&(f.style.willChange="width"),e=>{e.stopImmediatePropagation(),b=requestAnimationFrame(()=>{!1===h&&(h=!0,W.ActionBar.clear(),W.undoManager.start("style"),l.append(d,c));let t=parseInt(e.clientX)-v;if(v=e.clientX,0!==t){"e"==n&&(t*=-1);let e=parseFloat(t/q);if(0!==e){e=parseFloat(e/(x+A));let t=parseFloat(u[o[0]])+e,l=parseFloat(u[s[0]])-e;if(.001<t&&.001<l){t=t.toFixed(3)+"fr",l=l.toFixed(3)+"fr";for(let e=x-1;-1<e;--e)u[o[e]]=t;for(let e=A-1;-1<e;--e)u[s[e]]=l;i.style.setProperty("--col",u.join(" ")),d.textContent=t+" / "+r.offsetWidth+"px",f&&(c.textContent=l+" / "+f.clientWidth+"px")}}}})});l.tfOn("lostpointercapture",function(e){e.stopImmediatePropagation(),this.tfOff("pointermove",F,{passive:!0}),b&&cancelAnimationFrame(b),requestAnimationFrame(()=>{if(d.remove(),c.remove(),W.ActionBar.clear(),r.classList.remove("tb_element_clicked"),this.classList.remove("tb_drag_grid_current"),t.remove("tb_start_animate","tb_drag_grid_start"),r.style.willChange="",f&&(f.style.willChange=""),h){const e=i.closest("[data-cid]");for(let e=u.length-1;-1<e;--e)u[e]=parseFloat(parseFloat(u[e]).toFixed(3).replace("0.",".")).toString()+"fr";W.Registry.get(e.dataset.cid).setCols({size:u.join(" ")}),i.style.setProperty("--col",""),W.Utils.setCompactMode([r,f]),H.trigger("tb_grid_changed",e),W.Utils._onResize(!0),W.undoManager.end("style")}h=b=f=null})},{once:!0,passive:!0}).tfOn("pointermove",F,{passive:!0}).setPointerCapture(e.pointerId),t.add("tb_start_animate","tb_drag_grid_start")}})(jQuery,tb_app,Themify,window.top,document);