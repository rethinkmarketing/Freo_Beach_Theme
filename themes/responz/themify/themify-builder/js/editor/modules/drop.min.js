((N,R,n)=>{"use strict";N.Drop={async row(e,o,t,l){const s=async l=>{const s=n.createDocumentFragment(),i=[],r=[],a=null===e.closest(".tb_holder");for(let t=0,e=l.length;t<e;++t){let e=new(!0==a?N.Row:N.Subrow)(l[t]);if(s.appendChild(e.el),i.push(e),"visual"===N.mode&&"grid"!==o){let t=e.el.querySelectorAll("[data-cid]");r.push(e.id);for(let e=t.length-1;-1<e;--e)r.push(t[e].dataset.cid);e.el.style.visibility="hidden"}}if(e.replaceWith(s),N.Builder.get().removeLayoutButton(),"visual"===N.mode&&await N.bootstrap(r),"pagebreak"!==o){await N.correctColumnPaddings();for(let e=0,t=i.length;e<t;++e)N.Utils.setCompactMode(i[e].el.tfClass("module_column")),N.Utils.runJs(i[e].el),i[e].el.style.visibility=""}else N.pageBreakModule.countModules();"grid"!==o&&"pagebreak"!==o&&N.Spinner.showLoader("done")};if(!1!==l&&N.Utils.scrollTo(e),"library"===o||"predesign"===o){const i="library"===o?await this.Library.row(t):await N.preDesignedRows.get(t);await s(i)}else if("pagebreak"===o)await s(N.pageBreakModule.get());else{if("grid"!==o)throw"";await s(N.Utils.grid(t))}},async column(s,e,p){const i=s.parentNode,l=!e,r=!i,o=!0==r?null:N.Registry.get(i.closest("[data-cid]").dataset.cid),n=e?e.parentNode:i,g=N.Registry.get(n.closest("[data-cid]").dataset.cid),T=g.get("sizes"),c=o?o.get("sizes"):{},t="left"!==p&&e?e.nextElementSibling:e,f=getComputedStyle(s).getPropertyValue("grid-area").split("/")[0].replace('"',"").trim();if(i!==n){n.insertBefore(s,t);const a=n.classList.contains("subrow_inner");if(s.classList.toggle("sub_column",a),s.classList.toggle("tb-column",!a),i&&!i.firstChild){const _=new N.Column({grid_class:"col-full"},i.classList.contains("subrow_inner"));i.appendChild(_.el)}}else!0==l&&s.remove();const m=N.activeBreakPoint,d=n.childElementCount,u=i?i.childElementCount:0,y=getComputedStyle(n),h=N.breakpointsReverse,U=!1==l&&e?getComputedStyle(e).getPropertyValue("grid-area").split("/")[0].replaceAll('"',"").trim():null,w=e=>{if(!e.includes(" "))return y.getPropertyValue("--c"+e);if((e=e.replace(/\s\s+/g," ").trim()).includes("repeat")){if(e.includes("auto-fit")||e.includes("auto-fill"))return"";{let i="",r=e.replace(/\s\,\s|\s\,|\,\s/g,",").replace(/\s\(\s|\s\(|\(\s/g,"(").replaceAll(" )",")").trim().split(" ");for(let s=0,e=r.length;s<e;++s)if(r[s].includes("repeat")){let e=r[s].split("(")[1].replace(")","").split(","),t=parseInt(e[0]),l=e[1].trim();isNaN(t)&&(l="1fr",t=childCount),i+=" "+(" "+l).repeat(t)}else i+=" "+r[s];e=i.trim()}}return e},C=(e,l)=>{const s=l.length,t=N.getColClass(),i=N.getColClassValues(),r=e&&!e.includes(" ")&&void 0!==t[e]?t[e]:t[s],a=i.length-1;for(let e=s-1;-1<e;--e){let t=l[e].classList;for(let e=a;-1<e;--e)t.remove(i[e]);void 0!==r&&s<7&&t.add(r[e]),t.remove("first","last")}1<s&&(l[0].classList.add("first"),l[s-1].classList.add("last"))};if(i===n&&!1==l&&!1==r)if("desktop"===m){const b={},z={},v=y.getPropertyValue("--area").replaceAll('"',"").trim().split(" "),L=i.children,S=L.length;i.classList.remove("direction_rtl"),o.setSizes({dir:""});for(let t=S-1;-1<t;--t){let e=L[t].dataset.cid;e&&(b[e]=t+1)}let e=y.getPropertyValue("--col");if(i.insertBefore(s,t),e&&"unset"!==e&&"initial"!==e&&"none"!==e&&!e.includes("repeat")){const A=v.indexOf(f),P=getComputedStyle(s).getPropertyValue("grid-area").split("/")[0].replaceAll('"',"").trim(),k=v.indexOf(P),x=(e=e.split(" "))[k];e[k]=e[A],e[A]=x,o.setCols({size:e.join(" ")},m)}for(let t=S-1;-1<t;--t){let e=L[t].dataset.cid;e&&(z[e]=t+1)}for(let l=h.length-2;-1<l;--l){let e=h[l],t=c[e+"_area"];if(t){t.includes('"')||(t=y.getPropertyValue("--area"+t).replace(/\s\s+/g," ").trim());for(let e in z)b[e]!==z[e]&&(t=t.replaceAll(b[e]+" ","#"+z[e]+"# ").replaceAll(b[e]+'"',"#"+z[e]+'#"'));o.setCols({area:t.replaceAll("#","")},e)}}C(e,L)}else{let i=y.getPropertyValue("--area").replace(/  +/g," ").trim(),l=y.getPropertyValue("--col"),e="right"===p?1:0,t="left",s,r=i.split('" "')[0].split(" ").length,a=(i=i.replaceAll('"',"").trim().split(" ")).indexOf(U),o=i.indexOf(f),n=o,c=R.convert(i),d=i.length,u=[];if(n<a&&(t="right",e="right"===p?0:-1,n=i.lastIndexOf(f)),a+=e,s=i[a],"left"===t)for(let s=n-1;s>=a;--s){let t=i[s],l=i[s+1];if(t!==l)for(let e=s;e<d;++e)i[e]===l&&(i[e]="_"+t)}else for(let s=n+1;s<=a;++s){let t=i[s],l=i[s-1];if(t!==l)for(let e=0;e<s;++e)i[e]===l&&(i[e]="_"+t)}for(let e=d-1;-1<e;--e)"_"===i[e][0]?i[e]=i[e].substring(1):s===i[e]&&(i[e]=f);for(let e=0,t=d/r;e<t;++e)u.push('"'+i.slice(e*r,(e+1)*r).join(" ")+'"');const B={area:u=u.join(" ")};if(l&&"unset"!==l&&"initial"!==l&&"none"!==l){const V=parseInt(o/r),G=u.replaceAll('"',"").trim().split(" ").indexOf(f),I=parseInt(G/r);if(I===V&&(l=w(l))){l=l.split(" ");const M=[],j=u.split('" "')[V].replaceAll('"',"").split(" ");c=c.slice(V*r,V*r+r);for(let t=0,e=j.length;t<e;++t){let e=c.indexOf(j[t]);M[t]=l[e],c.slice(e,1)}B.size=M.join(" ")}}g.setCols(B,m)}else{let a="1fr";if(!1==r){let e={},t={},l=[],r=c.desktop_size,s=parseInt(f.replace("col",""));for(let e=1;e<=u+1;++e)l[e-1]=e;r=r&&"1"!==r&&1!==r?(r=w(r))&&r.split(" "):null;for(let t=l.length-1;-1<t;--t){let e=parseInt(l[t]);e===s?(r&&void 0!==r[t]&&(a=r[t],r.splice(t,1)),l.splice(t,1)):(e>s&&--e,l[t]="col"+e)}if(a&&"1fr"!==a){let s=parseFloat(a),i=0;if(r&&.1<s-1){for(let t=r.length-1;-1<t;--t){let e=parseFloat(r[t]);(1<s&&e<1||s<1&&1<e)&&++i}if(0<i){let l=parseFloat(s/i);s<1&&(l*=-1);for(let t=r.length-1;-1<t;--t){let e=parseFloat(r[t]);(1<s&&e<1||s<1&&1<e)&&(r[t]=e+l+"fr")}}}}C(r=1!==u&&r?ThemifyStyles.getColSize(r.join(" "),!1):null,i.children),1===u?(l=null,t.gutter=e["--area"]=e["--colg"]=""):l='"'+l.join(" ")+'"',t.area=l,t.size=r,o.setCols(t),r||(e["--col"]=""),o.setGridCss(e),i.classList.remove("tb_col_count_"+(u+1)),i.classList.add("tb_col_count_"+u)}if(!1==l){let t=[],e={},l=T.desktop_size;for(let e=1;e<d+1;++e)t[e-1]="col"+e;if(l=l||"1fr"===a?l:"1fr ".repeat(d).trim())if(l=w(l)){l=l.split(" ");let e=R.convert(n.children).indexOf(s);l.length<d?l.splice(e,0,a):l[e]=a,l=ThemifyStyles.getColSize(l.join(" "),!1)}else l=null;l||(e["--col"]=""),C(l,n.children),t='"'+t.join(" ")+'"',g.setCols({area:t,size:l}),g.setGridCss(e),n.classList.remove("tb_col_count_"+(d-1)),n.classList.add("tb_col_count_"+d),g.setMaxGutter()}const O=new Set;for(let e=h.length-2;-1<e;--e){let t=h[e];if(!1==r){let e=o.getGridCss({size:"auto"},t);"auto"!==o.getSizes("size",t)&&O.add(N.Helper.getBreakpointName(t)),e["--area"]&&!e["--area"].includes(" ")?o.setCols({size:"auto"},t):(o.setGridCss({"--area":"","--col":""},t),o.setSizes({size:"auto"},t))}if(!1==l){"auto"!==g.getSizes("size",t)&&O.add(N.Helper.getBreakpointName(t));let e=g.getGridCss({size:"auto"},t);e["--area"]&&!e["--area"].includes(" ")?g.setCols({size:"auto"},t):(g.setGridCss({"--area":"","--col":""},t),g.setSizes({size:"auto"},t)),g.setMaxGutter()}}O.size}N.Utils._onResize(!0)},async module(e,t,l,s){if(!1!==s&&N.Utils.scrollTo(e),"part"!==t&&"module"!==t){const i=N.Module.getDefault(l),r=new N.Module({mod_settings:i,mod_name:l});return r.is_new=!0,e.replaceWith(r.el),r.trigger("edit"),"visual"===N.mode&&"layout-part"!==l&&"overlay-content"!==l&&await r.trigger(r.getPreviewType(),i),r}await this.Library.module(e,t,l)},Library:{async row(e){let t=await N.Library.get(e,"row");if(!Array.isArray(t)){t=new Array(t);const l=N.GS.findUsedItems(t);!1!==l&&l.length&&(t[0].used_gs=l)}return t},async module(e,t,l,s){const i=await N.Library.get(l,t),r=new N.Module(i),a=r.get("mod_settings");return"visual"===N.mode&&await N.bootstrap([r.id]),e.replaceWith(r.el),r.is_new=!0,await r.trigger("edit"),await r.trigger(r.getPreviewType(),a),!1!==s&&N.Utils.scrollTo(r.el),N.Builder.get().removeLayoutButton(),r}}}})(tb_app,Themify,document);