((h,s,c,i)=>{"use strict";h.Tree={init(){const t=c.tfId("tb_tree_root"),e=t.firstElementChild;e&&(t.attachShadow({mode:e.getAttribute("shadowroot")}).appendChild(e.content),e.remove()),"visual"===h.mode&&i.top.document.body.appendChild(t),this.el=t.shadowRoot.querySelector(".wrapper"),s.loadCss(s.builder_url+"/css/editor/modules/tree",null,null,this.el),s.on("themify_builder_ready",()=>{const e=h.MainPanel.el.getRootNode().querySelector("#module_combine_style");t.shadowRoot.prepend(h.ToolBar.getBaseCss(),e.cloneNode(!0),this.getGridCss()),setTimeout(()=>{this.events(),this.draggable(),this.resize()},200)},!0,h.is_builder_ready)},getGridCss(){const e=c.tfId("themify_concate-css")||c.tfId("themify-builder-style-css"),i=e.sheet.cssRules,s=[],l=[],n=ThemifyStyles.getColSize(),o=ThemifyStyles.getArea(),r=ThemifyStyles.getGutter(),t=c.createElement("style");for(let e in r)l.push("--"+e+":"+r[e]);let a;for(let t=i.length-1;-1<t;--t){let e=i[t].selectorText;if(e)if(e.includes(".row_inner")&&e.includes(".subrow_inner")&&i[t].cssText.includes("--col")&&i[t].cssText.includes("grid-template-areas")){let s=i[t].cssText.replace(e,"").replace("{","").replace("}","").trim().split(";");a=e;for(let t=s.length-1;-1<t;--t)if(s[t]){let e=s[t].split(":")[0].trim();if(e&&void 0===n[e]&&void 0===o[e]&&void 0===r[e]){let e=s[t].replace(";","").trim();l.includes(e)||l.push(e)}}}else e.includes(".module_column")&&(i[t].cssText.includes("grid-area")||i[t].cssText.includes("grid-template-columns"))&&s.push(i[t].cssText.trim())}for(let e in n)l.push(e+":"+n[e]);for(let e in o)l.push(e+":"+ThemifyStyles.normalizeArea(o[e]));return s.push(a+"{"+l.join(";")+"}"),t.id="grid_css",t.innerHTML=s.join(""),t},getTree(){console.time("TREE");const e=c.createElement("template"),n=c.createElement("button"),t=(n.type="button",n.className="tf_plus_icon tf_rel",e.innerHTML=h.Builder.get().el.outerHTML,e.content.firstChild.children),o=s=>{const l=s[0].classList.contains("module_row")?"row":"subrow";for(let t=s.length-1;-1<t;--t)if(s[t].classList.contains("module_"+l)){s[t].classList.remove("themify_builder_row","tf_clearfix"),s[t].removeAttribute("style");let i=s[t].children;for(let t=i.length-1;-1<t;--t){let e=i[t].classList;if(e.contains(l+"_inner")||e.contains("tb_row_info")){i[t].removeAttribute("style");let s=i[t].children;for(let t=s.length-1;-1<t;--t)if(s[t].classList.contains("module_column")){s[t].removeAttribute("style");let i=s[t].children;for(let t=i.length-1;-1<t;--t){let e=i[t].classList;if(e.contains("tb_holder")){i[t].removeAttribute("style");let s=i[t].children;for(let t=s.length-1;-1<t;--t){let l=s[t],e=l.classList;if(e.contains("active_module"))if(l.removeAttribute("style"),e.contains("active_subrow")){let t=l.children;for(let e=t.length-1;-1<e;--e)t[e].classList.contains("module_subrow")||t[e].remove();o(t)}else{let e=c.createElement("div"),t=c.createElement("div"),s=h.Registry.get(l.dataset.cid),i=s.getExcerpt();l.innerHTML=s.getImage(),e.innerHTML=s.getName(),e.className="module_name",t.className="excerpt",t.innerHTML=i,l.append(e,t)}else l.remove()}}else e.contains("tb_grid_drag")||e.contains("tb_col_side")||i[t].remove()}let e=n.cloneNode(!0);e.textContent="row"==l?"Column":"SubColumn",s[t].prepend(e)}else s[t].remove()}else i[t].remove()}let e=n.cloneNode(!0);e.textContent=l,s[t].prepend(e)}else s[t].remove()};return o(t),console.timeEnd("TREE"),e.content},open(){const e=this.el.tfClass("content")[0],t=this.getTree();while(null!==e.firstChild)e.lastChild.remove();e.appendChild(t),h.ToolBar.el.tfClass("tree")[0].classList.add("active"),this.el.style.transform="translate("+s.w/2+"px,"+s.h/2+"px)",this.el.getRootNode().host.classList.remove("tf_hide")},extend(e){const t=e.closest(".module_subrow,.module_column,.module_row");t&&t.classList.toggle("expand")},events(){this.el.tfOn(s.click,e=>{e.stopPropagation();const t=e.target;t.closest(".tf_close")?this.close():t.closest(".minimize")?this.minimize():this.extend(t)},{passive:!0})},close(){this.el.getRootNode().host.classList.add("tf_hide"),h.ToolBar.el.tfClass("tree")[0].classList.remove("active");const e=this.el.tfClass("content")[0];while(null!==e.firstChild)e.lastChild.remove()},minimize(){this.el.classList.toggle("is_minimized")},draggable(){const m=this;this.el.tfClass("header")[0].tfOn("pointerdown",function(e){if(1===e.which&&(e.target.classList.contains("title")||e.target===this)){e.stopImmediatePropagation();let t,n=m.el,s=this.ownerDocument;const i=e.clientX,l=e.clientY,o=n.getBoundingClientRect(),r=o.left-i,a=o.top-l,c=l=>{l.stopImmediatePropagation(),t=requestAnimationFrame(()=>{const e=l.clientX,t=l.clientY,s=r+e,i=a+t;n.style.transform="translate("+s+"px,"+i+"px)"})},d=e=>{e.stopImmediatePropagation()};n.style.willChange="transform",this.tfOn("lostpointercapture",function(e){e.stopImmediatePropagation(),t&&cancelAnimationFrame(t),this.tfOff("pointermove",d,{passive:!0,once:!0}).tfOff("pointermove",c,{passive:!0}),n.style.willChange="",!1===m.isStandalone&&(m.updateStorage(),m.setupLightboxSizeClass()),s.body.classList.remove("tb_start_animate","tb_drag_lightbox"),h.ToolBar.el.classList.remove("tb_start_animate","tb_drag_lightbox"),h.MainPanel.el.classList.remove("tb_start_animate","tb_drag_lightbox"),t=n=s=null},{passive:!0,once:!0}).tfOn("pointermove",d,{passive:!0,once:!0}).tfOn("pointermove",c,{passive:!0}).setPointerCapture(e.pointerId)}},{passive:!0})},resize(){const n=this,t=this.el.tfClass("tb_resizable");for(let e=t.length-1;-1<e;--e)t[e].tfOn("pointerdown",function(e){if(1===e.which){e.stopImmediatePropagation();let t=this.ownerDocument,o=n.el,s;o.style.willChange="transform,width,height";const r=350,a=880,c=.9*t.documentElement.clientHeight,d=parseInt(getComputedStyle(o).getPropertyValue("min-height")),m=this.dataset.axis,h=parseInt(o.offsetHeight,10),p=parseInt(o.offsetWidth,10),u=e.clientX,f=e.clientY,i=n=>{n.stopImmediatePropagation(),s=requestAnimationFrame(()=>{let e;const t=n.clientX,s=n.clientY,i=new DOMMatrix(getComputedStyle(o).transform);if("w"===m)(e=(e=u+p-t)>a?a:e)>=r&&e<=a&&(i.m41+=parseInt(o.style.width)-e,o.style.width=e+"px");else{const l="-y"===m||"ne"===m||"nw"===m?f+h-s:h+s-f;(e="sw"===m||"nw"===m?u+p-t:p+t-u)>a&&(e=a),("se"===m||"x"===m||"sw"===m||"nw"===m||"ne"===m)&&e>=r&&e<=a&&("sw"!==m&&"nw"!==m||(i.m41+=parseInt(o.style.width)-e),o.style.width=e+"px"),("se"===m||"y"===m||"-y"===m||"sw"===m||"nw"===m||"ne"===m)&&l>=d&&l<=c&&("-y"!==m&&"nw"!==m&&"ne"!==m||(i.m42+=parseInt(o.style.height)-l),o.style.height=l+"px")}o.style.transform="translate("+i.m41+"px,"+i.m42+"px)"})},l=function(e){e.stopImmediatePropagation(),s&&cancelAnimationFrame(s),this.tfOff("pointermove",i,{passive:!0}),o.style.willChange="",t.body.classList.remove("tb_start_animate"),t=o=s=null};this.tfOn("pointermove",i,{passive:!0}).tfOn("lostpointercapture",l,{passive:!0,once:!0}).setPointerCapture(e.pointerId),t.body.classList.add("tb_start_animate")}},{passive:!0})}},h.isGSPage||h.Tree.init()})(tb_app,Themify,document,window);