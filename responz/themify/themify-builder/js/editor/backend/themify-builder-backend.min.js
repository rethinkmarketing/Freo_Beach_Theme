((a,$,n,o,l)=>{"use strict";let r=!!l.is_gutenberg_editor;if(null!==n.querySelector("#page-builder.themify_write_panel"))r=!1,n.body.classList.remove("themify-gutenberg-editor");else if(!r)return;const t={init(){const t=n.tfId("tb_canvas_block");r&&!t?a.on("tb_canvas_loaded",()=>{this.init()},!0):(a.is_builder_active=!0,Promise.all([this.render(),o.jsModuleLoaded()]).then(()=>{"#builder_active"===window.location.hash&&(window.location.hash="",this.scrollToBuilder());let t=n.tfClass("tb_wp_editor_holder")[0],e=n.createElement("a");if(e.href="#",e.className="button tb_switch_frontend",e.textContent=l.i18n.switchToFrontendLabel,t)e=t.tfTag("a")[0];else{const i=n.querySelector("#postdivrich #wp-content-media-buttons");i&&i.appendChild(e)}e&&e.isConnected&&e.tfOn(a.click,t=>{t.preventDefault(),a.triggerEvent(o.ToolBar.el.tfClass("switch")[0],t.type)}),o.Registry.trigger(o.Builder.get(),"tb_init"),a.trigger("themify_builder_ready"),a.on("tb_scroll_to_builder",()=>{this.scrollToBuilder()}),o.is_builder_ready=!0}))},scrollToBuilder(){const t=n.tfId("page-buildert"),e=o.ToolBar.el;if(null!==t&&t.click(),r)o.Utils.scrollTo(e.getRootNode().host);else{let t=n.tfId("wpadminbar");t=t?t.offsetHeight:0,a.scrollTo(e.getBoundingClientRect().top-t)}},render(){const t=n.tfId("tmpl-builder_admin_canvas_block").content;if(r){const i=n.tfId("tb_canvas_block");i.innerHTML="",i.appendChild(t)}else n.tfId("tb_builder_placeholder").replaceWith(t);const e=o.Helper.correctBuilderData(l.builder_data);return o.FormTemplates.init().then(()=>{const t=n.tfId("tb_row_wrapper").firstElementChild;ThemifyStyles.init(o.FormTemplates.getItem(),o.breakpointsReverse,t.dataset.postid,themifyBuilder.gutters),new o.Builder(t,e,l.custom_css),this.initEvents()})},initEvents(){let s=!1;const e=n.querySelectorAll("input#publish,input#save-post,button.editor-post-publish-button__button,.editor-post-save-draft"),o=t=>{if(!1===s){s=!0,t.stopImmediatePropagation(),r||t.preventDefault();const e=t.currentTarget,i=t.type;this.saveCallback(e).finally(()=>{e.click(),setTimeout(()=>{e.tfOn(i,o,{once:!0}),s=!1},7e3)})}};for(let t=e.length-1;-1<t;--t)e[t].tfOn(a.click,o,{once:!0});a.on("tb_switch_frontend",t=>{this.switchFrontend(t)})},saveCallback(t){return r?t.setAttribute("aria-disabled","true"):t.classList.add("disabled"),o.ToolBar.save().then(()=>{o.undoManager.reset(),r?t.setAttribute("aria-disabled","false"):t.classList.remove("disabled")})},switchFrontend(s){let o,t=n.tfId("original_post_status");t=t&&t.value,(o="publish"===t?r?n.tfClass("editor-post-publish-button__button")[0]:n.tfId("publish"):r?n.tfClass("editor-post-save-draft")[0]:n.tfId("save-post"))&&this.saveCallback(o).then(()=>{if(r){const t=n.tfClass("editor-post-publish-button")[0];if(t){const e=new MutationObserver((t,e)=>{const i=t[0].target;setTimeout(()=>{i.classList.contains("is-busy")||n.tfClass("editor-post-saved-state")[0]||(window.location.href=s)},150)});e.observe(t,{attributes:!0})}}else{const i=n.tfId("page-builder");if(i&&!n.tfId("tb_switch_frontend")){let t=n.createElement("input");t.type="hidden",t.name=t.id="tb_switch_frontend",t.value="yes",i.appendChild(t)}}a.triggerEvent(o,a.click)})}},e=()=>{t.init(),"function"==typeof window.icl_copy_from_original&&$.ajaxPrefilter((t,e)=>{if(e.data&&"string"==typeof e.data&&e.data.includes("icl_ajx_action=copy_from_original")){const i=t.success,s=new URLSearchParams(e.data);t.success=t=>{const e=$("#tb_canvas_block");e.length&&e.hide().appendTo("body"),i(t),e.length&&$('#editor [data-type="themify-builder/canvas"]').empty().append(e.show()),a.fetch({action:"themify_builder_icl_copy_from_original",source_page_id:s.get("trid"),source_page_lang:s.get("lang")}).then(t=>{t.success&&o.Builder.get().reLoad(t.data,l.post_ID)})}}})};"complete"===n.readyState?e():window.tfOn("load",e,{once:!0,passive:!0})})(Themify,jQuery,document,tb_app,themifyBuilder);